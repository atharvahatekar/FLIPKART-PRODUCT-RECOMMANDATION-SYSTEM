<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!DOCTYPE html>
<html>
	<head>
		<title>Chatbot</title>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css')}}"/>
	</head>
	
	
<body style="min-height:100vh; background: linear-gradient(135deg, #232526 0%, #414345 100%); background-attachment: fixed;">
	<div class="container-fluid h-100 d-flex align-items-center justify-content-center" style="min-height:100vh;">
		<div class="row justify-content-center w-100">
			<div class="col-md-8 col-xl-6 chat">
				<div class="card shadow-lg" style="backdrop-filter: blur(12px) saturate(180%); background: rgba(44,47,54,0.85); border-radius: 24px; border: 1px solid rgba(255,255,255,0.08);">
					<div class="card-header msg_head" style="border-radius: 24px 24px 0 0; background: linear-gradient(90deg, #0056b3 0%, #003366 100%); box-shadow: 0 2px 12px rgba(0,0,0,0.08);">
						<div class="d-flex align-items-center">
							<div class="img_cont mr-3">
								<img src="https://static.vecteezy.com/system/resources/previews/016/017/018/non_2x/ecommerce-icon-free-png.png" class="rounded-circle user_img" style="box-shadow: 0 2px 8px rgba(0,0,0,0.15); border: 3px solid #fff; width: 56px; height: 56px;">
								<span class="online_icon"></span>
							</div>
							<div class="user_info">
								<span style="font-size:1.5rem; font-weight:700; letter-spacing:1px; color:#fff;">Flipkart Chatbot</span>
								<p style="margin-bottom:0; color:#e0e0e0; font-size:1rem;">Your AI Shopping Assistant</p>
							</div>
						</div>
					</div>
<div id="messageFormeight" class="card-body msg_card_body" style="background: rgba(28,30,37,0.7); border-radius: 0 0 24px 24px; min-height:320px; max-height:350px; overflow-y:auto; font-size:0.89rem;">
						<!-- Messages will appear here -->
					</div>
					<div class="card-footer" style="background: rgba(0,51,102,0.95); border-radius: 0 0 24px 24px;">
						<form id="messageArea" class="input-group" autocomplete="off">
							<input type="text" id="text" name="msg" placeholder="Type your message..." autocomplete="off" class="form-control type_msg" required style="background:rgba(59,63,71,0.95); color:#fff; border:none; border-radius: 12px 0 0 12px; font-size:1.1rem; padding:16px;">
							<div class="input-group-append">
								<button type="submit" id="send" class="input-group-text send_btn" style="background: linear-gradient(90deg,#ffb900,#f6a400); color:#232526; border:none; border-radius:0 12px 12px 0; font-weight:700; font-size:1.2rem; box-shadow:0 2px 8px rgba(255,185,0,0.08); transition: background 0.3s;">
									<i class="fas fa-location-arrow"></i>
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
		
		<script>
			$(document).ready(function() {
				$("#messageArea").on("submit", function(event) {
					const date = new Date();
					const hour = date.getHours();
					const minute = date.getMinutes();
					const str_time = hour+":"+minute;
					var rawText = $("#text").val();

					var userHtml = '<div class="d-flex justify-content-end mb-4 fade-in"><div class="msg_cotainer_send">' + rawText + '<span class="msg_time_send">'+ str_time + '</span></div><div class="img_cont_msg"><img src="https://i.ibb.co/d5b84Xw/Untitled-design.png" class="rounded-circle user_img_msg"></div></div>';
					$("#text").val("");
					$("#messageFormeight").append(userHtml);

					$.ajax({
						data: {
							msg: rawText,    
						},
						type: "POST",
						url: "/get",
					}).done(function(data) {
						// Convert response to a bulleted list if it contains newlines or bullet points
						let formatted = data;
						if (data.includes('\n')) {
							// Split by newlines, filter out empty lines
							let items = data.split(/\n|\r/).map(s => s.trim()).filter(s => s.length > 0);
							// Remove leading bullet or star signs if present
							items = items.map(s => s.replace(/^[-*â€¢]+\s*/, '').replace(/^\*\*(.*?)\*\*/, '$1'));
							if (items.length > 1) {
								formatted = '<ul style="padding-left: 1.2em; margin-bottom:0;">' + items.map(s => '<li>' + s + '</li>').join('') + '</ul>';
							} else {
								formatted = items[0];
							}
						}
						var botHtml = '<div class="d-flex justify-content-start mb-4 fade-in"><div class="img_cont_msg"><img src="https://static.vecteezy.com/system/resources/previews/016/017/018/non_2x/ecommerce-icon-free-png.png" class="rounded-circle user_img_msg"></div><div class="msg_cotainer">' + formatted + '<span class="msg_time">' + str_time + '</span></div></div>';
						$("#messageFormeight").append($.parseHTML(botHtml));
						// Animate scroll to bottom
						$("#messageFormeight").animate({ scrollTop: $("#messageFormeight")[0].scrollHeight }, 400);
					});
					event.preventDefault();
				});
			});
		// Subtle fade-in animation for messages
		</script>
		<style>
			.fade-in {
				animation: fadeIn 0.7s cubic-bezier(0.39, 0.575, 0.565, 1) both;
			}
			@keyframes fadeIn {
				0% { opacity: 0; transform: translateY(20px) scale(0.98); }
				100% { opacity: 1; transform: none; }
			}
		</style>
		
	</body>
</html>